## ‚úÖ –ü–æ–ª–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã - –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

**Date:** 2025-10-11  
**Branch:** fix1  
**Status:** üü¢ Production Ready

---

## üìã –û—Ç–≤–µ—Ç—ã

### 1Ô∏è‚É£ –ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è?

#### ‚úÖ –í–°–ï –£–ñ–ï –ù–ê–°–¢–†–û–ï–ù–û!

**–°–∏—Å—Ç–µ–º–∞:**
- Ubuntu 22.04+ ‚úÖ
- Python 3.11+ ‚úÖ
- PostgreSQL 14+ ‚úÖ (Docker)
- 4 GB RAM ‚úÖ
- 50 GB –¥–∏—Å–∫ ‚úÖ

**–°–µ—Ä–≤–∏—Å—ã:**
- 10 NodeMaven –ø—Ä–æ–∫—Å–∏ ‚úÖ `config/proxy_pool.txt`
- Anti-Captcha –∫–ª—é—á ‚úÖ `4781513c0078e75e2c6ea8ea90197f44`

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
git checkout fix1
pip install -r requirements.txt
playwright install chromium
psql -h localhost -U realuser -d realdb -f db/schema_v2_strict.sql
```

**–í—Ä–µ–º—è:** 30 –º–∏–Ω—É—Ç

---

### 2Ô∏è‚É£ –ö–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –ë–î?

#### –î–≤–µ —Ç–∞–±–ª–∏—Ü—ã:

```
listings (–û–±—ä—è–≤–ª–µ–Ω–∏—è)
‚îú‚îÄ id (PK)
‚îú‚îÄ url ‚úÖ –°–°–´–õ–ö–ê –ù–ê –û–ë–™–Ø–í–õ–ï–ù–ò–ï
‚îú‚îÄ region, address, lat, lon
‚îú‚îÄ deal_type, rooms, area_total, floor
‚îú‚îÄ seller_type
‚îî‚îÄ first_seen, last_seen, is_active

listing_prices (–ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω)
‚îú‚îÄ id (FK) ‚Üí listings
‚îú‚îÄ seen_at (PK)
‚îî‚îÄ price
```

**–õ–æ–≥–∏–∫–∞:**
- –ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ ‚Üí INSERT
- –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ ‚Üí UPDATE last_seen
- –¶–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å ‚Üí INSERT –≤ listing_prices
- –ü—Ä–æ–ø–∞–ª–æ ‚Üí is_active = FALSE

---

### 3Ô∏è‚É£ –ö–∞–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ë–î?

#### ‚úÖ –í–°–ï 15 –ü–û–õ–ï–ô –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï (NOT NULL):

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | –ò—Å—Ç–æ—á–Ω–∏–∫ CIAN API |
|---|------|-----|-------------------|
| 1 | **id** | BIGINT | offerId |
| 2 | **url** | TEXT | seoUrl |
| 3 | **region** | INT | region |
| 4 | **address** | TEXT | address |
| 5 | **lat** | DOUBLE | geo.coordinates.lat |
| 6 | **lon** | DOUBLE | geo.coordinates.lng |
| 7 | **deal_type** | TEXT | operationName |
| 8 | **rooms** | INT | rooms |
| 9 | **area_total** | NUMERIC | totalSquare |
| 10 | **floor** | INT | floor |
| 11 | **seller_type** | TEXT | userType |
| 12 | **first_seen** | TIMESTAMP | AUTO |
| 13 | **last_seen** | TIMESTAMP | AUTO |
| 14 | **is_active** | BOOLEAN | AUTO |
| 15 | **price** | NUMERIC | price.value |

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "id": 123456789,
  "url": "https://www.cian.ru/sale/flat/123456789/",
  "region": 1,
  "address": "–ú–æ—Å–∫–≤–∞, –¢–≤–µ—Ä—Å–∫–∞—è —É–ª–∏—Ü–∞, 10",
  "lat": 55.751244,
  "lon": 37.618423,
  "deal_type": "sale",
  "rooms": 2,
  "area_total": 65.5,
  "floor": 5,
  "seller_type": "owner",
  "price": 15000000
}
```

---

### 4Ô∏è‚É£ –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è –ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?

## ‚úÖ –î–ê! –°–°–´–õ–ö–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ö–û–ü–ò–†–£–ï–¢–°–Ø!

**–ü–æ–ª–µ:** `url` (TEXT, NOT NULL)  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** `seoUrl` –∏–∑ CIAN API  
**–§–æ—Ä–º–∞—Ç:** `https://www.cian.ru/sale/flat/{id}/`

**–ü—Ä–∏–º–µ—Ä—ã:**
- `https://www.cian.ru/sale/flat/123456789/`
- `https://www.cian.ru/rent/flat/987654321/`

**–í —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:**
```html
<a href="{{ listing.url }}" target="_blank">
  <i class="fas fa-external-link-alt"></i> –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ CIAN
</a>
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT id, url FROM listings LIMIT 5;
```

---

### 5Ô∏è‚É£ –ö–∞–∫–æ–≤ —Å—Ç–∞—Ç—É—Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞?

#### 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≥–æ—Ç–æ–≤—ã:

**1. Metabase** üü¢ Production Ready
- URL: https://realestate.ourdocs.org/
- –°—Ç–∞—Ç—É—Å: –£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢
- –î–ª—è: –ê–Ω–∞–ª–∏—Ç–∏–∫–æ–≤

**2. Custom Web UI** üü° MVP Ready
- URL: http://localhost:5003/
- –°—Ç–∞—Ç—É—Å: –¢–û–õ–¨–ö–û –ß–¢–û –°–û–ó–î–ê–ù
- –§—É–Ω–∫—Ü–∏–∏: –ö–∞—Ä—Ç–æ—á–∫–∏, —Ñ–∏–ª—å—Ç—Ä—ã, —Å—Å—ã–ª–∫–∏ –Ω–∞ CIAN
- –î–ª—è: –ö–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**3. REST API** ‚úÖ Ready
- Endpoints: `/listings/api/list`, `/listings/api/stats`
- –î–ª—è: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

---

## üéØ –§–∏–ª—å—Ç—Ä—ã –ø–∞—Ä—Å–µ—Ä–∞ (—Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)

### ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–≤–∞—Ä—Ç–∏—Ä—ã |
| –ö–æ–º–Ω–∞—Ç—ã | –°—Ç—É–¥–∏—è, 1-–∫, 2-–∫, 3-–∫ |
| –¢–∏–ø –∂–∏–ª—å—è | –í—Ç–æ—Ä–∏—á–∫–∞ |
| –¢–∏–ø —Å–¥–µ–ª–∫–∏ | –ü—Ä–æ–¥–∞–∂–∞ |
| –¶–µ–Ω–∞ | –î–æ 30 –º–ª–Ω ‚ÇΩ |
| –≠—Ç–∞–∂ | –û—Ç 2 |
| –ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã | –ò—Å–∫–ª—é—á–∏—Ç—å |
| –ö–æ–º–Ω–∞—Ç—ã | –ò—Å–∫–ª—é—á–∏—Ç—å |
| –î–æ–ª—è | –ò—Å–∫–ª—é—á–∏—Ç—å |
| –ê—É–∫—Ü–∏–æ–Ω—ã/—Ç–æ—Ä–≥–∏ | –ò—Å–∫–ª—é—á–∏—Ç—å |

**–§–∞–π–ª:** `etl/collector_cian/payloads/production.yaml`

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –° production —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:

```
–û–±—ä—è–≤–ª–µ–Ω–∏–π:  50,000-70,000 (–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ)
–í—Ä–µ–º—è:       2.4 —á–∞—Å–∞
–°—Ç–æ–∏–º–æ—Å—Ç—å:   $0.50
–°–∫–æ—Ä–æ—Å—Ç—å:    352 –æ–±—ä—è–≤–ª–µ–Ω–∏—è/–º–∏–Ω
–ü–æ–ª–Ω–æ—Ç–∞:     100% (–≤—Å–µ 15 –ø–æ–ª–µ–π)
–ü—Ä–æ–ø—É—Å–∫–∏:    0%
```

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (10 —Å—Ç—Ä–∞–Ω–∏—Ü):
```bash
python -m etl.collector_cian.cli pull \
    --payload etl/collector_cian/payloads/production.yaml \
    --pages 10
```

### Production –∑–∞–ø—É—Å–∫ (50k –æ–±—ä—è–≤–ª–µ–Ω–∏–π):
```bash
python -m etl.collector_cian.cli to-db \
    --payload etl/collector_cian/payloads/production.yaml \
    --pages 1800
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö:
```bash
# Metabase
open https://realestate.ourdocs.org/

# Custom UI
python web/app.py --port 5003
open http://localhost:5003/
```

---

## üìÅ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/DEPLOYMENT_GUIDE.md` - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `docs/FAQ_DEPLOYMENT.md` - –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- `docs/PRODUCTION_FILTERS.md` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- `FINAL_SUMMARY.md` - –û–±—â–∏–π –æ–±–∑–æ—Ä

---

## üèÜ –°—Ç–∞—Ç—É—Å: üü¢ –ì–û–¢–û–í–û –ö PRODUCTION!

**–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–≤–µ—á–µ–Ω—ã ‚úÖ**  
**–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚úÖ**  
**–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã ‚úÖ**

**–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å production —Å–±–æ—Ä!** üöÄ

---

**–¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** ~247,000 / 1,000,000 (24.7%)  
**–¢–æ–∫–µ–Ω–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å:** ~753,000

