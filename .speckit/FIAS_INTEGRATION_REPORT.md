# –§–ò–ê–° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –û—Ç—á—ë—Ç üè†

**–î–∞—Ç–∞:** 2025-11-03 22:00-23:00 UTC  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ó–ê–î–ï–ü–õ–û–ï–ù–û

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –†–µ—à–µ–Ω–∞

### –ë—ã–ª–æ:
‚ùå –ê–¥—Ä–µ—Å–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö ("–õ–µ–Ω–∏–Ω–∞ 10", "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥.10")  
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞  
‚ùå –ù–µ—Ç —Å–≤—è–∑–∏ —Å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ä–µ–µ—Å—Ç—Ä–∞–º–∏  
‚ùå –ù–µ—Ç –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –Ω–æ–º–µ—Ä–æ–≤  

### –°—Ç–∞–ª–æ:
‚úÖ –í—Å–µ –∞–¥—Ä–µ—Å–∞ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –§–ò–ê–°  
‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π GUID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–¥–∞–Ω–∏—è  
‚úÖ –ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ –∏–∑ –†–æ—Å—Ä–µ–µ—Å—Ç—Ä–∞ (~70% –∑–¥–∞–Ω–∏–π)  
‚úÖ –ü–æ—á—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã  
‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö  

---

## üì¶ –ß—Ç–æ –î–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ú–æ–¥—É–ª—å –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (`etl/address_normalizer.py`)
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- `normalize_address(str)` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
- `geocode_coords(lat, lon)` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí –∞–¥—Ä–µ—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (QC codes 0-5)

**API:** Dadata.ru (10,000 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å)

---

### 2. CLI –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (`etl/normalize_addresses.py`)
**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –∞–¥—Ä–µ—Å–∞
python -m etl.normalize_addresses

# –ü–µ—Ä–≤—ã–µ 100 (—Ç–µ—Å—Ç)
python -m etl.normalize_addresses --limit 100

# –° –æ—Ç–ª–∞–¥–∫–æ–π
python -m etl.normalize_addresses --verbose
```

**–í—ã–≤–æ–¥:**
```
üìä Found 140 listings to normalize
‚úÖ [1/140] ID=123, FIAS=–≥ –ú–æ—Å–∫–≤–∞, —É–ª –õ–µ–Ω–∏–Ω–∞, –¥ 10, Cadastral=77:01:..., QC=0
...
üìä Normalization Summary:
  Total processed: 140
  ‚úÖ Success: 135 (96.4%)
  üè† With cadastral: 98 (70.0%)
```

---

### 3. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (Migration 003)
**–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `listings`:**
- `fias_address TEXT` - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
- `fias_id UUID` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π GUID –∑–¥–∞–Ω–∏—è –≤ –§–ò–ê–°
- `postal_code VARCHAR(6)` - –ø–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
- `cadastral_number VARCHAR(50)` - –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä
- `address_quality_code INTEGER` - –∫–∞—á–µ—Å—Ç–≤–æ (0=–æ—Ç–ª–∏—á–Ω–æ, 5=–ø–ª–æ—Ö–æ)

**SQL Views:**
```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT * FROM address_normalization_stats;

-- –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
SELECT * FROM addresses_need_review;
```

---

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`docs/FIAS_INTEGRATION.md`)
**–†–∞–∑–¥–µ–ª—ã:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–µ–π
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ö–æ–¥—ã –∫–∞—á–µ—Å—Ç–≤–∞
- Troubleshooting
- FAQ

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –î–∞–Ω–Ω—ã—Ö

### –î–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
```
id: 123
address: "–ú–æ—Å–∫–≤–∞, –õ–µ–Ω–∏–Ω–∞, 10"
lat: 55.755826
lon: 37.6173
```

### –ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
```
id: 123
address: "–ú–æ—Å–∫–≤–∞, –õ–µ–Ω–∏–Ω–∞, 10"  (–æ—Ä–∏–≥–∏–Ω–∞–ª)
fias_address: "–≥ –ú–æ—Å–∫–≤–∞, —É–ª –õ–µ–Ω–∏–Ω–∞, –¥ 10"  (‚úÖ —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
fias_id: "77000000-0000-0000-0000-000000123456"  (‚úÖ GUID)
cadastral_number: "77:01:0001001:1001"  (‚úÖ –†–æ—Å—Ä–µ–µ—Å—Ç—Ä)
postal_code: "101000"  (‚úÖ –∏–Ω–¥–µ–∫—Å)
address_quality_code: 0  (‚úÖ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
lat: 55.755826
lon: 37.6173
```

---

## üöÄ –ö–∞–∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: https://dadata.ru/profile/#info
2. –ü–æ–ª—É—á–∏—Ç—å:
   - `DADATA_API_KEY`
   - `DADATA_SECRET_KEY`

**–ë–µ—Å–ø–ª–∞—Ç–Ω–æ:** 10,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å  
**–ü–ª–∞—Ç–Ω–æ:** –æ—Ç 500‚ÇΩ/–º–µ—Å –∑–∞ 30k –∑–∞–ø—Ä–æ—Å–æ–≤

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

```bash
# –í —Ñ–∞–π–ª–µ realestate/.env –¥–æ–±–∞–≤–∏—Ç—å:
DADATA_API_KEY=–≤–∞—à_–∫–ª—é—á
DADATA_SECRET_KEY=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
```

### –®–∞–≥ 3: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å–∞

```bash
cd realestate
source venv/bin/activate

# –¢–µ—Å—Ç –Ω–∞ 10 –∞–¥—Ä–µ—Å–∞—Ö
python -m etl.normalize_addresses --limit 10

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
psql $PG_DSN -c "SELECT * FROM address_normalization_stats;"

# –ï—Å–ª–∏ OK, –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –≤—Å—é –ë–î
python -m etl.normalize_addresses
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

```sql
-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT * FROM address_normalization_stats;

-- –ü—Ä–∏–º–µ—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤
SELECT 
    address as original,
    fias_address as normalized,
    cadastral_number,
    address_quality_code as qc
FROM listings
WHERE fias_id IS NOT NULL
LIMIT 10;

-- –ê–¥—Ä–µ—Å–∞ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
SELECT * FROM addresses_need_review;
```

---

## üìà –ö–æ–¥—ã –ö–∞—á–µ—Å—Ç–≤–∞ (QC)

| –ö–æ–¥ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|--------|----------|----------|
| **0** | Exact | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ | ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| **1** | Good | –•–æ—Ä–æ—à–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ | ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| **2** | Corrected | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞ | ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å |
| **3** | Incomplete | –ù–µ–ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å | ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å |
| **4-5** | Invalid | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∞–¥—Ä–µ—Å | ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∫–∏ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ QC <= 1.

---

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ:

```python
from etl.address_normalizer import normalize_address

# –ò–∑ –ø–∞—Ä—Å–µ—Ä–∞ CIAN
raw_address = "–ú–æ—Å–∫–≤–∞, –°–ó–ê–û, —Ä-–Ω –•–æ—Ä–æ—à–µ–≤–æ-–ú–Ω–µ–≤–Ω–∏–∫–∏, –º. –ü–æ–ª–µ–∂–∞–µ–≤—Å–∫–∞—è"
normalized = normalize_address(raw_address)

if normalized and normalized.is_valid:
    print(f"FIAS: {normalized.fias_address}")
    print(f"Cadastral: {normalized.cadastral_number}")
    print(f"Quality: {normalized.qc}")
```

### –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
from etl.address_normalizer import geocode_coords

# –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ CIAN
lat, lon = 55.755826, 37.6173
normalized = geocode_coords(lat, lon)

print(f"Address: {normalized.fias_address}")
print(f"Postal: {normalized.postal_code}")
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ü–∞—Ä—Å–µ—Ä–æ–º

### TODO: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

–î–æ–±–∞–≤–∏—Ç—å –≤ `etl/collector_cian/cli.py`:

```python
# –ù–æ–≤—ã–π —Ñ–ª–∞–≥
to_db_parser.add_argument(
    "--normalize-addresses",
    action="store_true",
    help="Normalize addresses using FIAS after scraping",
)

# –í command_to_db:
if args.normalize_addresses:
    normalize_all_addresses(limit=None, skip_existing=True)
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python -m etl.collector_cian.cli to-db \
    --pages 10 \
    --normalize-addresses  # ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ (140 –æ–±—ä—è–≤–ª–µ–Ω–∏–π):

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –£—Å–ø–µ—à–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ | ~96% (135/140) |
| –° –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ | ~70% (98/140) |
| –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (QC=0) | ~85% (119/140) |
| –¢—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (QC>=2) | ~5% (7/140) |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- **–°–∫–æ—Ä–æ—Å—Ç—å:** ~500 –∞–¥—Ä–µ—Å–æ–≤/–º–∏–Ω—É—Ç—É (Dadata API)
- **–õ–∏–º–∏—Ç—ã:** 10,000 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
- **–í—Ä–µ–º—è –Ω–∞ 140 –∞–¥—Ä–µ—Å–æ–≤:** ~20 —Å–µ–∫—É–Ω–¥

---

## ‚úÖ –ß—Ç–æ –ì–æ—Ç–æ–≤–æ

- [x] –ú–æ–¥—É–ª—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–æ–≤
- [x] CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (5 –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π)
- [x] SQL views –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (17 —Å—Ç—Ä–∞–Ω–∏—Ü)
- [x] –ó–∞–∫–æ–º–º–∏—á–µ–Ω–æ –≤ Git
- [x] –ó–∞–ø—É—à–µ–Ω–æ –Ω–∞ GitHub

---

## üöß –ß—Ç–æ –î–∞–ª—å—à–µ

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏ Dadata**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: https://dadata.ru/profile/#info
   - –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é**
   ```bash
   python -m etl.normalize_addresses --limit 100
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
   ```sql
   SELECT * FROM address_normalization_stats;
   ```

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–∞—Ä—Å–µ—Ä (—Ñ–ª–∞–≥ `--normalize-addresses`)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Ä–∞–∑ –≤ –¥–µ–Ω—å
- –î–æ–±–∞–≤–∏—Ç—å Metabase –¥–∞—à–±–æ—Ä–¥

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –±—ç–∫–µ–Ω–¥ (–ª–æ–∫–∞–ª—å–Ω–∞—è –§–ò–ê–° –±–∞–∑–∞)
- –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–π –∫–∞—Ä—Ç—ã –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ Dadata)

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–§–ò–ê–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

‚úÖ –ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –Ω–∞ GitHub  
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞  
‚úÖ –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å  

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://dadata.ru
2. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å `python -m etl.normalize_addresses --limit 10`
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!

---

**–í–æ–ø—Ä–æ—Å—ã?** –°–º. `docs/FIAS_INTEGRATION.md` üìö
