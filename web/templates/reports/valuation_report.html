<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отчёт об оценке - {{ address }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #192B1F;
            --color-accent: #C6A27B;
            --color-light: #f8f9fa;
            --color-text: #333;
            --color-muted: #6c757d;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background: #f5f5f5;
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .report {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: var(--color-primary);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            height: 50px;
        }

        .logo-text {
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            font-weight: 600;
            color: var(--color-accent);
            letter-spacing: 1px;
        }

        .header-info {
            text-align: right;
            font-size: 14px;
            opacity: 0.9;
        }

        /* Content */
        .content {
            padding: 40px;
        }

        h1 {
            font-family: 'Oswald', sans-serif;
            font-size: 28px;
            color: var(--color-primary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        h2 {
            font-family: 'Oswald', sans-serif;
            font-size: 20px;
            color: var(--color-primary);
            margin-top: 35px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--color-accent);
            font-weight: 500;
        }

        h3 {
            font-size: 16px;
            color: var(--color-muted);
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: var(--color-light);
            font-weight: 600;
            color: var(--color-primary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: #fafafa;
        }

        .highlight {
            background: rgba(198, 162, 123, 0.15) !important;
            font-weight: 600;
        }

        .excluded {
            color: #999;
            text-decoration: line-through;
        }

        /* Result box */
        .result-box {
            background: linear-gradient(135deg, var(--color-primary), #2a4536);
            color: white;
            padding: 35px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }

        .result-box h2 {
            color: var(--color-accent);
            border: none;
            margin: 0 0 10px 0;
            padding: 0;
            font-size: 18px;
        }

        .result-box .price {
            font-family: 'Oswald', sans-serif;
            font-size: 48px;
            font-weight: 700;
            margin: 15px 0;
            color: white;
        }

        .result-box .subtitle {
            opacity: 0.85;
            font-size: 14px;
        }

        .result-box .price-per-sqm {
            font-size: 20px;
            color: var(--color-accent);
            margin-top: 10px;
        }

        /* Comparison cards */
        .comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .comparison-item {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .comparison-item.seller {
            background: #fee2e2;
            border: 2px solid var(--color-danger);
        }

        .comparison-item.market {
            background: #fef3c7;
            border: 2px solid var(--color-warning);
        }

        .comparison-item.interest {
            background: #d1fae5;
            border: 2px solid var(--color-success);
        }

        .comparison-item .label {
            font-size: 12px;
            color: var(--color-muted);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .comparison-item .value {
            font-family: 'Oswald', sans-serif;
            font-size: 22px;
            font-weight: 600;
        }

        /* Formula box */
        .formula {
            background: var(--color-light);
            padding: 20px 25px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border-left: 4px solid var(--color-accent);
            font-size: 14px;
        }

        .formula strong {
            color: var(--color-primary);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success { background: #d1fae5; color: #059669; }
        .badge-warning { background: #fef3c7; color: #d97706; }
        .badge-danger { background: #fee2e2; color: #dc2626; }
        .badge-primary { background: rgba(198, 162, 123, 0.2); color: var(--color-primary); }

        /* Info box */
        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            line-height: 1.8;
        }

        /* Warning box */
        .warning-box {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .warning-box strong {
            color: var(--color-danger);
        }

        /* Methodology list */
        .methodology-list {
            list-style: none;
            padding: 0;
        }

        .methodology-list li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
            border-bottom: 1px solid #f0f0f0;
        }

        .methodology-list li:last-child {
            border-bottom: none;
        }

        .methodology-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 14px;
            width: 10px;
            height: 10px;
            background: var(--color-accent);
            border-radius: 50%;
        }

        /* Meta info */
        .meta {
            color: var(--color-muted);
            font-size: 13px;
            margin-bottom: 25px;
        }

        .meta a {
            color: var(--color-accent);
            text-decoration: none;
        }

        .meta a:hover {
            text-decoration: underline;
        }

        /* Footer */
        .footer {
            background: var(--color-light);
            padding: 20px 40px;
            text-align: center;
            font-size: 12px;
            color: var(--color-muted);
            border-top: 1px solid #e9ecef;
        }

        .footer-brand {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .header-info {
                text-align: center;
            }

            .content {
                padding: 25px;
            }

            .comparison {
                grid-template-columns: 1fr;
            }

            .result-box .price {
                font-size: 36px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px 10px;
            }
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
            padding: 25px;
            background: var(--color-light);
            border-radius: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0d1a13;
        }

        .btn-telegram {
            background: #0088cc;
            color: white;
        }

        .btn-telegram:hover {
            background: #006699;
        }

        .btn-outline {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-outline:hover {
            background: var(--color-primary);
            color: white;
        }

        @media print {
            body {
                background: white;
            }

            .container {
                max-width: 100%;
                padding: 0;
            }

            .report {
                box-shadow: none;
            }

            .action-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="report">
            <!-- Header -->
            <div class="header">
                <div>
                    <div class="logo-text">НЕВСКИЙ ЭКСПРЕСС</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Оценка недвижимости</div>
                </div>
                <div class="header-info">
                    <div><strong>Дата:</strong> {{ report_date }}</div>
                    <div><strong>ID:</strong> {{ report_id }}</div>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <h1>Отчёт об оценке квартиры</h1>

                <div class="meta">
                    {% if cian_id %}
                    <strong>ID объявления ЦИАН:</strong> {{ cian_id }}<br>
                    <strong>Ссылка:</strong> <a href="https://www.cian.ru/sale/flat/{{ cian_id }}/" target="_blank">https://www.cian.ru/sale/flat/{{ cian_id }}/</a>
                    {% endif %}
                </div>

                <!-- 1. Object Info -->
                <h2>1. Объект оценки</h2>
                <table>
                    <tr><th style="width: 40%">Параметр</th><th>Значение</th></tr>
                    <tr><td>Адрес</td><td><strong>{{ address }}</strong></td></tr>
                    {% if district %}
                    <tr><td>Район</td><td>{{ district }}</td></tr>
                    {% endif %}
                    {% if metro %}
                    <tr><td>Метро</td><td>{{ metro }}</td></tr>
                    {% endif %}
                    <tr><td>Площадь</td><td><strong>{{ area_total }} м²</strong></td></tr>
                    {% if rooms %}
                    <tr><td>Комнаты</td><td>{{ rooms }}</td></tr>
                    {% endif %}
                    {% if floor %}
                    <tr><td>Этаж</td><td>{{ floor }}{% if total_floors %}/{{ total_floors }}{% endif %}</td></tr>
                    {% endif %}
                </table>

                <!-- 2. Data Sources -->
                <h2>2. Источники данных</h2>

                {% if rosreestr_deals and rosreestr_deals|length > 0 %}
                <h3>2.1 Росреестр — официальные сделки</h3>
                <table>
                    <tr>
                        <th>Улица</th>
                        <th>Площадь</th>
                        <th>Этаж</th>
                        <th>Год</th>
                        <th>Материал</th>
                        <th>Цена сделки</th>
                        <th>₽/м²</th>
                        <th>Статус</th>
                    </tr>
                    {% for deal in rosreestr_deals %}
                    <tr class="{% if deal.is_direct_analog %}highlight{% elif deal.excluded %}excluded{% endif %}">
                        <td>{% if deal.is_direct_analog %}<strong>{% endif %}{{ deal.street or '-' }}{% if deal.is_direct_analog %}</strong>{% endif %}</td>
                        <td>{% if deal.is_direct_analog %}<strong>{% endif %}{{ deal.area }} м²{% if deal.is_direct_analog %}</strong>{% endif %}</td>
                        <td>{{ deal.floor or '-' }}</td>
                        <td>{{ deal.year or '-' }}</td>
                        <td>{{ deal.material or '-' }}</td>
                        <td>{% if deal.is_direct_analog %}<strong>{% endif %}{{ "{:,.0f}".format(deal.price).replace(",", " ") }} ₽{% if deal.is_direct_analog %}</strong>{% endif %}</td>
                        <td><strong>{{ "{:,.0f}".format(deal.price_per_sqm).replace(",", " ") }}</strong></td>
                        <td>
                            {% if deal.is_direct_analog %}
                            <span class="badge badge-success">ПРЯМОЙ АНАЛОГ</span>
                            {% elif deal.excluded %}
                            <span class="badge badge-danger">{{ deal.exclude_reason or 'Исключено' }}</span>
                            {% elif deal.is_newbuild %}
                            <span class="badge badge-warning">Новостройка</span>
                            {% else %}
                            <span class="badge badge-primary">Релевантный</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </table>
                {% endif %}

                {% if cian_analogs and cian_analogs|length > 0 %}
                <h3>2.2 ЦИАН — актуальные предложения</h3>
                {% if cian_filter_description %}
                <p style="color: var(--color-muted); margin-bottom: 15px;"><strong>{{ cian_filter_description }}</strong></p>
                {% endif %}
                <table>
                    <tr>
                        <th>Адрес</th>
                        <th>Площадь</th>
                        <th>Год</th>
                        <th>Ремонт</th>
                        <th>Цена</th>
                        <th>₽/м²</th>
                    </tr>
                    {% for analog in cian_analogs %}
                    <tr class="{% if loop.index <= 3 %}highlight{% endif %}">
                        <td>{{ analog.address }}</td>
                        <td>{{ analog.area }} м²</td>
                        <td>{{ analog.year or '-' }}</td>
                        <td>{{ analog.renovation or '-' }}</td>
                        <td>{{ "{:,.0f}".format(analog.price).replace(",", " ") }} ₽</td>
                        <td><strong>{{ "{:,.0f}".format(analog.price_per_sqm).replace(",", " ") }}</strong></td>
                    </tr>
                    {% endfor %}
                </table>
                {% endif %}

                <!-- 3. Statistics -->
                <h2>3. Статистика (очищенная от аномалий)</h2>

                {% if filter_criteria %}
                <div class="info-box">
                    <strong>Критерии отбора:</strong><br>
                    {% for criteria in filter_criteria %}
                    • {{ criteria }}<br>
                    {% endfor %}
                </div>
                {% endif %}

                <table>
                    <tr><th>Показатель</th><th>Значение</th></tr>
                    {% if analogs_count %}
                    <tr><td>Аналогов использовано</td><td>{{ analogs_count }}</td></tr>
                    {% endif %}
                    {% if avg_area %}
                    <tr><td>Средняя площадь</td><td>{{ "%.1f"|format(avg_area) }} м²</td></tr>
                    {% endif %}
                    <tr><td><strong>Средняя ₽/м²</strong></td><td><strong>{{ "{:,.0f}".format(avg_price_per_sqm).replace(",", " ") }}</strong></td></tr>
                    <tr><td><strong>Медиана ₽/м²</strong></td><td><strong>{{ "{:,.0f}".format(median_price_per_sqm).replace(",", " ") }}</strong></td></tr>
                    <tr><td>Минимум</td><td>{{ "{:,.0f}".format(min_price_per_sqm).replace(",", " ") }}</td></tr>
                    <tr><td>Максимум</td><td>{{ "{:,.0f}".format(max_price_per_sqm).replace(",", " ") }}</td></tr>
                </table>

                <!-- 4. Расчёт рыночной цены -->
                <h2>4. Расчёт рыночной цены</h2>

                <h3>4.1 Источники (с корректировкой)</h3>
                <table>
                    <tr>
                        <th>Источник</th>
                        <th>Кол-во</th>
                        <th>Медиана ₽/м²</th>
                        <th>Торг</th>
                        <th>Скорр. ₽/м²</th>
                    </tr>
                    <tr>
                        <td>Росреестр (сделки)</td>
                        <td>{{ rosreestr_count|default(0) }}</td>
                        <td>{{ "{:,.0f}".format(rosreestr_median|default(0)).replace(",", " ") }}</td>
                        <td>0%</td>
                        <td><strong>{{ "{:,.0f}".format(rosreestr_median|default(0)).replace(",", " ") }}</strong></td>
                    </tr>
                    <tr>
                        <td>ЦИАН (предложения)</td>
                        <td>{{ cian_count|default(0) }}</td>
                        <td>{{ "{:,.0f}".format(cian_median|default(0)).replace(",", " ") }}</td>
                        <td>−{{ bargain_percent }}%</td>
                        <td><strong>{{ "{:,.0f}".format((cian_median|default(0)) * (1 - bargain_percent/100)).replace(",", " ") }}</strong></td>
                    </tr>
                </table>

                <div class="formula">
                    <strong>Рыночная цена (медиана скорректированных):</strong><br>
                    {{ "{:,.0f}".format(market_price_per_sqm|default(median_price_per_sqm)).replace(",", " ") }} ₽/м² × {{ area_total }} м² = <strong>{{ "{:,.0f}".format(market_price|default(median_price_per_sqm * area_total)).replace(",", " ") }} ₽</strong>
                </div>

                <!-- 5. Расходы на сделку -->
                <h2>5. Расходы на сделку</h2>

                <h3>5.1 Фиксированные расходы</h3>
                <table>
                    <tr><th>Статья</th><th>Сумма</th></tr>
                    <tr><td>Нотариус</td><td>{{ "{:,.0f}".format(cost_notary|default(50000)).replace(",", " ") }} ₽</td></tr>
                    <tr><td>Госпошлина</td><td>{{ "{:,.0f}".format(cost_duty|default(4000)).replace(",", " ") }} ₽</td></tr>
                    <tr><td>ПИП ({{ area_total }} м² × 1 500 ₽)</td><td>{{ "{:,.0f}".format(cost_pip|default(area_total * 1500)).replace(",", " ") }} ₽</td></tr>
                    <tr><td>Агентские</td><td>{{ "{:,.0f}".format(cost_agent|default(200000)).replace(",", " ") }} ₽</td></tr>
                    <tr><td>Регистраторы</td><td>{{ "{:,.0f}".format(cost_registrar|default(25000)).replace(",", " ") }} ₽</td></tr>
                    <tr><td>Контур</td><td>{{ "{:,.0f}".format(cost_kontur|default(4000)).replace(",", " ") }} ₽</td></tr>
                    <tr class="highlight"><td><strong>Итого фиксированные</strong></td><td><strong>{{ "{:,.0f}".format(fixed_costs|default(50000+4000+area_total*1500+200000+25000+4000)).replace(",", " ") }} ₽</strong></td></tr>
                </table>

                {% if has_dynamic_costs %}
                <h3>5.2 Динамические расходы</h3>
                <table>
                    <tr><th>Статья</th><th>Сумма</th></tr>
                    {% if cost_renovation %}
                    <tr><td>Ремонт ({{ area_total }} м² × {{ "{:,.0f}".format(renovation_per_sqm|default(50000)).replace(",", " ") }} ₽)</td><td>{{ "{:,.0f}".format(cost_renovation).replace(",", " ") }} ₽</td></tr>
                    <tr><td>Прораб</td><td>{{ "{:,.0f}".format(cost_foreman|default(100000)).replace(",", " ") }} ₽</td></tr>
                    {% endif %}
                    {% if cost_eviction %}
                    <tr><td>Выселение жильцов</td><td>{{ "{:,.0f}".format(cost_eviction).replace(",", " ") }} ₽</td></tr>
                    {% endif %}
                    <tr class="highlight"><td><strong>Итого динамические</strong></td><td><strong>{{ "{:,.0f}".format(dynamic_costs|default(0)).replace(",", " ") }} ₽</strong></td></tr>
                </table>
                {% endif %}

                <div class="formula">
                    <strong>Всего расходов:</strong> {{ "{:,.0f}".format(total_costs|default(fixed_costs|default(363400))).replace(",", " ") }} ₽
                </div>

                <!-- 6. Инвестиционный расчёт -->
                <h2>6. Инвестиционный расчёт</h2>

                <div class="info-box">
                    <strong>Целевые параметры:</strong><br>
                    • Доходность: <strong>{{ target_monthly_rate|default(4) }}% в месяц</strong> чистыми ({{ target_monthly_rate|default(4) * project_months|default(3) }}% за {{ project_months|default(3) }} мес.)<br>
                    • Минимальная прибыль: <strong>{{ "{:,.0f}".format(min_profit|default(1000000)).replace(",", " ") }} ₽</strong><br>
                    • Налог на прибыль: <strong>{{ tax_rate|default(6) }}%</strong>
                </div>

                <div class="formula">
                    <strong>Расчёт целевой прибыли:</strong><br>
                    Рыночная цена × {{ target_monthly_rate|default(4) * project_months|default(3) }}% / (1 + {{ target_monthly_rate|default(4) * project_months|default(3) }}%) = <br>
                    {{ "{:,.0f}".format(market_price|default(median_price_per_sqm * area_total)).replace(",", " ") }} × {{ "%.2f"|format((target_monthly_rate|default(4) * project_months|default(3))/100) }} / {{ "%.2f"|format(1 + (target_monthly_rate|default(4) * project_months|default(3))/100) }} = <strong>{{ "{:,.0f}".format(target_profit|default(1000000)).replace(",", " ") }} ₽</strong><br><br>

                    <strong>С учётом налога {{ tax_rate|default(6) }}%:</strong><br>
                    {{ "{:,.0f}".format(target_profit|default(1000000)).replace(",", " ") }} / (1 − {{ "%.2f"|format((tax_rate|default(6))/100) }}) = <strong>{{ "{:,.0f}".format(target_profit_gross|default(1063830)).replace(",", " ") }} ₽</strong> (до налога)
                </div>

                <!-- 7. Итоговый расчёт -->
                <h2>7. Цена интереса</h2>

                <div class="formula" style="font-size: 15px;">
                    <strong>Цена интереса = Рыночная − Расходы − Прибыль (до налога)</strong><br><br>
                    {{ "{:,.0f}".format(market_price|default(median_price_per_sqm * area_total)).replace(",", " ") }} − {{ "{:,.0f}".format(total_costs|default(363400)).replace(",", " ") }} − {{ "{:,.0f}".format(target_profit_gross|default(1063830)).replace(",", " ") }} = <br>
                    <strong style="font-size: 20px; color: var(--color-accent);">{{ "{:,.0f}".format(interest_price).replace(",", " ") }} ₽</strong>
                </div>

                <!-- Result -->
                <div class="result-box">
                    <h2>Итоговая оценка</h2>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Рыночная цена</div>
                            <div style="font-family: 'Oswald', sans-serif; font-size: 24px; font-weight: 600;">{{ "%.1f"|format((market_price|default(median_price_per_sqm * area_total)) / 1000000) }} млн</div>
                            <div style="font-size: 12px; opacity: 0.7;">цена продажи</div>
                        </div>
                        <div style="text-align: center; border-left: 1px solid rgba(255,255,255,0.2); border-right: 1px solid rgba(255,255,255,0.2);">
                            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Расходы + Прибыль</div>
                            <div style="font-family: 'Oswald', sans-serif; font-size: 24px; font-weight: 600;">−{{ "%.1f"|format(((total_costs|default(363400)) + (target_profit_gross|default(1063830))) / 1000000) }} млн</div>
                            <div style="font-size: 12px; opacity: 0.7;">{{ target_monthly_rate|default(4) }}%/мес × {{ project_months|default(3) }} мес</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Цена интереса</div>
                            <div style="font-family: 'Oswald', sans-serif; font-size: 28px; font-weight: 700; color: var(--color-accent);">{{ "%.1f"|format(interest_price / 1000000) }} млн</div>
                            <div style="font-size: 12px; color: var(--color-accent);">макс. цена покупки</div>
                        </div>
                    </div>
                </div>

                <!-- Methodology -->
                <h2>8. Обоснование методологии</h2>
                <ol class="methodology-list">
                    {% for item in methodology %}
                    <li><strong>{{ item.title }}</strong> — {{ item.description }}</li>
                    {% endfor %}
                </ol>
            </div>

            <!-- Action buttons -->
            <div class="action-buttons">
                <button onclick="window.print()" class="btn btn-primary">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M5 1a2 2 0 0 0-2 2v1h10V3a2 2 0 0 0-2-2H5zm6 8H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1z"/>
                        <path d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2H2a2 2 0 0 1-2-2V7zm2.5 1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                    </svg>
                    Скачать PDF
                </button>
                <a href="https://t.me/share/url?url={{ report_url_full|urlencode }}&text={{ ('Отчёт об оценке: ' ~ address)|urlencode }}" target="_blank" class="btn btn-telegram">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.287 5.906c-.778.324-2.334.994-4.666 2.01-.378.15-.577.298-.595.442-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294.26.006.549-.1.868-.32 2.179-1.471 3.304-2.214 3.374-2.229.05-.01.119-.026.166.016.047.041.042.12.037.141-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8.154 8.154 0 0 1-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629.094.06.183.125.27.187.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.426 1.426 0 0 0-.013-.315.337.337 0 0 0-.114-.217.526.526 0 0 0-.31-.093c-.3.005-.763.166-2.984 1.09z"/>
                    </svg>
                    Поделиться в Telegram
                </a>
                <a href="https://nevsky.express" target="_blank" class="btn btn-outline">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"/>
                    </svg>
                    nevsky.express
                </a>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p>Отчёт сформирован автоматически на основе данных Росреестра и ЦИАН</p>
                <p><span class="footer-brand">Невский Экспресс</span> • {{ report_date }}</p>
            </div>
        </div>
    </div>
</body>
</html>
