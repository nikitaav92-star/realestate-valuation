2025-10-11 08:46:05,426 [INFO] __main__: üöÄ Starting CIAN Anti-bot Bypass Tests
2025-10-11 08:46:05,426 [INFO] __main__: ================================================================================
2025-10-11 08:46:05,431 [INFO] __main__: Testing HTTP direct request...
2025-10-11 08:46:05,432 [DEBUG] __main__: Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json', 'Content-Type': 'application/json', 'Referer': 'https://www.cian.ru/', 'Origin': 'https://www.cian.ru'}
2025-10-11 08:46:05,546 [DEBUG] httpcore.connection: connect_tcp.started host='www.cian.ru' port=443 local_address=None timeout=30.0 socket_options=None
2025-10-11 08:46:05,630 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7d27ddc12750>
2025-10-11 08:46:05,631 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x7d27ddc666d0> server_hostname='www.cian.ru' timeout=30.0
2025-10-11 08:46:05,684 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7d27ddd9d760>
2025-10-11 08:46:05,684 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-10-11 08:46:05,685 [DEBUG] httpcore.http11: send_request_headers.complete
2025-10-11 08:46:05,686 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-10-11 08:46:05,686 [DEBUG] httpcore.http11: send_request_body.complete
2025-10-11 08:46:05,687 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-10-11 08:46:05,866 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'server', b'ycalb'), (b'date', b'Sat, 11 Oct 2025 08:46:05 GMT'), (b'content-type', b'text/html'), (b'vary', b'Accept-Encoding'), (b'set-cookie', b'_CIAN_GK=927dfcef-7e35-4271-9358-b68c7c0c113c; Expires=Thu, 11 Oct 2035 11:46:05 GMT; Max-Age=315543600; Domain=cian.ru; Path=/; Secure; SameSite=None'), (b'set-cookie', b'_CIAN_GK=65f42359-9840-4095-b210-63c605966f3a; Expires=Thu, 11 Oct 2035 11:46:05 GMT; Max-Age=315543600; Domain=cian.ru; Path=/; Secure; SameSite=None'), (b'etag', b'W/"68e6501e-4f9f"'), (b'content-encoding', b'gzip'), (b'set-cookie', b'_yasc=U0CIknYH8cfqnSI8uMtcP9csAkMQo73ygZJEwqbhsTmZT4CZM/FJ6DucLYeGOQ==; domain=.cian.ru; path=/; expires=Tue, 09 Oct 2035 08:46:05 GMT; secure'), (b'transfer-encoding', b'chunked')])
2025-10-11 08:46:05,867 [INFO] httpx: HTTP Request: POST https://www.cian.ru/site/v1/offers/search/grouped/ "HTTP/1.1 404 Not Found"
2025-10-11 08:46:05,867 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-10-11 08:46:05,868 [DEBUG] httpcore.http11: receive_response_body.complete
2025-10-11 08:46:05,869 [DEBUG] httpcore.http11: response_closed.started
2025-10-11 08:46:05,869 [DEBUG] httpcore.http11: response_closed.complete
2025-10-11 08:46:05,870 [DEBUG] httpcore.connection: close.started
2025-10-11 08:46:05,870 [DEBUG] httpcore.connection: close.complete
2025-10-11 08:46:05,871 [INFO] __main__: ================================================================================
2025-10-11 08:46:05,871 [INFO] __main__: ‚ùå FAILED: HTTP Direct (no proxy)
2025-10-11 08:46:05,871 [INFO] __main__: Duration: 0.44s
2025-10-11 08:46:05,871 [INFO] __main__: Status Code: 404
2025-10-11 08:46:05,871 [INFO] __main__: Response Size: 20383 bytes
2025-10-11 08:46:05,871 [WARNING] __main__: üö´ BLOCKED by anti-bot
2025-10-11 08:46:05,871 [ERROR] __main__: Error: Blocked with status 404
2025-10-11 08:46:05,871 [DEBUG] __main__: Response Headers:
2025-10-11 08:46:05,871 [DEBUG] __main__:   server: ycalb
2025-10-11 08:46:05,871 [DEBUG] __main__:   date: Sat, 11 Oct 2025 08:46:05 GMT
2025-10-11 08:46:05,871 [DEBUG] __main__:   content-type: text/html
2025-10-11 08:46:05,871 [DEBUG] __main__:   vary: Accept-Encoding
2025-10-11 08:46:05,871 [DEBUG] __main__:   set-cookie: _CIAN_GK=927dfcef-7e35-4271-9358-b68c7c0c113c; Expires=Thu, 11 Oct 2035 11:46:05 GMT; Max-Age=315543600; Domain=cian.ru; Path=/; Secure; SameSite=None, _CIAN_GK=65f42359-9840-4095-b210-63c605966f3a; Expires=Thu, 11 Oct 2035 11:46:05 GMT; Max-Age=315543600; Domain=cian.ru; Path=/; Secure; SameSite=None, _yasc=U0CIknYH8cfqnSI8uMtcP9csAkMQo73ygZJEwqbhsTmZT4CZM/FJ6DucLYeGOQ==; domain=.cian.ru; path=/; expires=Tue, 09 Oct 2035 08:46:05 GMT; secure
2025-10-11 08:46:05,872 [DEBUG] __main__:   etag: W/"68e6501e-4f9f"
2025-10-11 08:46:05,872 [DEBUG] __main__:   content-encoding: gzip
2025-10-11 08:46:05,872 [DEBUG] __main__:   transfer-encoding: chunked
2025-10-11 08:46:05,872 [DEBUG] __main__: Response Preview (first 500 chars):
<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="//cdn.cian.site/frontend/common-css/l/common.min.css" /><title>&#x41E;&#x448;&#x438;&#x431;&#x43A;&#x430; 404 - &#x426;&#x438;&#x430;&#x43D;</title><style>.button,.title{font-weight:700}body{height:100vh}.logo-image{width:386px;margin-bottom:52px}.container{height:auto;padding:80px;-ms-flex-positive:1;flex-grow:1;-ms-flex-negative:0;fle
2025-10-11 08:46:05,873 [INFO] __main__: ================================================================================
2025-10-11 08:46:07,873 [INFO] __main__: Using proxy: http://gate.nodemaven.com:8080
2025-10-11 08:46:07,876 [INFO] __main__: Testing HTTP with proxy...
2025-10-11 08:46:07,877 [DEBUG] __main__: Proxy: http://gate.nodemaven.com:8080
2025-10-11 08:46:07,877 [ERROR] __main__: HTTP with proxy test failed
Traceback (most recent call last):
  File "/opt/realestate/scripts/test_antibot_cian.py", line 196, in test_http_with_proxy
    response = httpx.post(
               ^^^^^^^^^^^
TypeError: post() got an unexpected keyword argument 'proxies'
2025-10-11 08:46:07,878 [INFO] __main__: ================================================================================
2025-10-11 08:46:07,878 [INFO] __main__: ‚ùå FAILED: HTTP with Residential Proxy (NodeMaven)
2025-10-11 08:46:07,879 [INFO] __main__: Duration: 0.01s
2025-10-11 08:46:07,879 [ERROR] __main__: Error: post() got an unexpected keyword argument 'proxies'
2025-10-11 08:46:07,879 [INFO] __main__: ================================================================================
2025-10-11 08:46:09,880 [INFO] __main__: Testing Playwright with fingerprint painting...
2025-10-11 08:46:09,880 [DEBUG] asyncio: Using selector: EpollSelector
2025-10-11 08:46:10,660 [INFO] __main__: Using proxy: http://gate.nodemaven.com:8080
2025-10-11 08:46:10,911 [INFO] __main__: Navigating to: https://www.cian.ru/cat.php?deal_type=sale&engine_version=2&offer_type=flat&region=1
2025-10-11 08:46:41,083 [ERROR] __main__: Playwright stealth test failed
Traceback (most recent call last):
  File "/opt/realestate/scripts/test_antibot_cian.py", line 272, in test_playwright_stealth
    response = page.goto(url, wait_until="networkidle", timeout=30000)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/realestate/.venv/lib/python3.12/site-packages/playwright/sync_api/_generated.py", line 9019, in goto
    self._sync(
  File "/opt/realestate/.venv/lib/python3.12/site-packages/playwright/_impl/_sync_base.py", line 115, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/opt/realestate/.venv/lib/python3.12/site-packages/playwright/_impl/_page.py", line 556, in goto
    return await self._main_frame.goto(**locals_to_params(locals()))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/realestate/.venv/lib/python3.12/site-packages/playwright/_impl/_frame.py", line 153, in goto
    await self._channel.send(
  File "/opt/realestate/.venv/lib/python3.12/site-packages/playwright/_impl/_connection.py", line 69, in send
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/realestate/.venv/lib/python3.12/site-packages/playwright/_impl/_connection.py", line 558, in wrap_api_call
    raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
playwright._impl._errors.TimeoutError: Page.goto: Timeout 30000ms exceeded.
Call log:
  - navigating to "https://www.cian.ru/cat.php?deal_type=sale&engine_version=2&offer_type=flat&region=1", waiting until "networkidle"

2025-10-11 08:46:41,087 [INFO] __main__: ================================================================================
2025-10-11 08:46:41,087 [INFO] __main__: ‚ùå FAILED: Playwright with Stealth Fingerprint
2025-10-11 08:46:41,087 [INFO] __main__: Duration: 31.21s
2025-10-11 08:46:41,087 [ERROR] __main__: Error: Page.goto: Timeout 30000ms exceeded.
Call log:
  - navigating to "https://www.cian.ru/cat.php?deal_type=sale&engine_version=2&offer_type=flat&region=1", waiting until "networkidle"

2025-10-11 08:46:41,087 [INFO] __main__: ================================================================================
2025-10-11 08:46:43,087 [INFO] __main__: ================================================================================
2025-10-11 08:46:43,087 [INFO] __main__: ‚ùå FAILED: Playwright with Storage State
2025-10-11 08:46:43,087 [INFO] __main__: Duration: 0.00s
2025-10-11 08:46:43,087 [ERROR] __main__: Error: No storage state configured (set CIAN_STORAGE_STATE)
2025-10-11 08:46:43,087 [INFO] __main__: ================================================================================
2025-10-11 08:46:43,087 [INFO] __main__: 
================================================================================
2025-10-11 08:46:43,087 [INFO] __main__: üìä TEST SUMMARY
2025-10-11 08:46:43,087 [INFO] __main__: ================================================================================
2025-10-11 08:46:43,087 [INFO] __main__: ‚ùå HTTP Direct (no proxy)                             üö´ BLOCKED 
2025-10-11 08:46:43,087 [INFO] __main__:    Error: Blocked with status 404
2025-10-11 08:46:43,087 [INFO] __main__: ‚ùå HTTP with Residential Proxy (NodeMaven)             
2025-10-11 08:46:43,087 [INFO] __main__:    Error: post() got an unexpected keyword argument 'proxies'
2025-10-11 08:46:43,087 [INFO] __main__: ‚ùå Playwright with Stealth Fingerprint                 
2025-10-11 08:46:43,087 [INFO] __main__:    Error: Page.goto: Timeout 30000ms exceeded.
Call log:
  - navigating to "https://www.cian.ru/cat.php?deal_type=sale&engine_version=2&offer_type=flat&region=1", waiting until "networkidle"

2025-10-11 08:46:43,088 [INFO] __main__: ‚ùå Playwright with Storage State                       
2025-10-11 08:46:43,088 [INFO] __main__:    Error: No storage state configured (set CIAN_STORAGE_STATE)
2025-10-11 08:46:43,088 [INFO] __main__: ================================================================================
2025-10-11 08:46:43,088 [INFO] __main__: Success Rate: 0/4 (0.0%)
2025-10-11 08:46:43,091 [INFO] __main__: Results saved to: /opt/realestate/logs/antibot_test_results.json
