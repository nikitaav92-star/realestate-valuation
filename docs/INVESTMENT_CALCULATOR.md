# üíº –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä - "–¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞"

## üìä –ß—Ç–æ —Ç–∞–∫–æ–µ "–¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞"?

**–¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞** ‚Äî —ç—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤—ã–≥–æ–¥–Ω–æ–π —Å —É—á–µ—Ç–æ–º:
- –¢–æ—Ä–≥–∞ —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º
- –í—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–¥–µ–ª–∫—É
- –ù–∞–ª–æ–≥–∞ –Ω–∞ –ø—Ä–∏–±—ã–ª—å
- –¶–µ–ª–µ–≤–æ–π –ø—Ä–∏–±—ã–ª–∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞

## üéØ –¶–µ–ª—å

–ü–æ–º–æ—á—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å **–≤–µ—Ä—Ö–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É —Ü–µ–Ω—ã –ø–æ–∫—É–ø–∫–∏**, –≤—ã—à–µ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–≤—ã–≥–æ–¥–Ω—ã–º.

---

## üìê –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞

### 1. –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- **–†—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞** ‚Äî –æ—Ü–µ–Ω–∫–∞ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¶–ò–ê–ù (hybrid KNN + Grid)
- **–ü–ª–æ—â–∞–¥—å** ‚Äî –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä—ã (–º¬≤)

### 2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```python
# –¢–æ—Ä–≥ –∏ –ø—Ä–∏–±—ã–ª—å
bargain_discount = 7%           # –°–∫–∏–¥–∫–∞ –Ω–∞ —Ç–æ—Ä–≥ —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º
target_profit_rate = 17.3%      # –¶–µ–ª–µ–≤–∞—è –ø—Ä–∏–±—ã–ª—å –∑–∞ 4 –º–µ—Å—è—Ü–∞ (4.32%/–º–µ—Å)

# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
notary_fee = 50,000 ‚ÇΩ           # –ù–æ—Ç–∞—Ä–∏—É—Å
state_fee = 4,000 ‚ÇΩ             # –ì–æ—Å–ø–æ—à–ª–∏–Ω–∞
pip_per_sqm = 1,500 ‚ÇΩ/–º¬≤        # –ü–ò–ü (–ø–æ—ç—Ç–∞–∂–Ω—ã–π –ø–ª–∞–Ω)
agency_fee = 200,000 ‚ÇΩ          # –ê–≥–µ–Ω—Ç—Å–∫–∏–µ
utilities_per_month = 11,500 ‚ÇΩ  # –ñ–ö–£ (4 –º–µ—Å—è—Ü–∞)

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
tax_rate = 13%                  # –ù–∞–ª–æ–≥ –Ω–∞ –ø—Ä–∏–±—ã–ª—å
```

### 3. –†–∞—Å—á–µ—Ç:

```
–û–∂–∏–¥–∞–µ–º–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ = –†—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞ √ó (1 - 0.07)

–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã = 50,000 + 4,000 + (1,500 √ó –ü–ª–æ—â–∞–¥—å) + 200,000 + (11,500 √ó 4)

–¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ = (–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ / (1 + 0.173 / 0.87)) - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
```

### 4. –ü—Ä–∏–º–µ—Ä –¥–ª—è –∫–≤–∞—Ä—Ç–∏—Ä—ã 71.7 –º¬≤:

```
–†—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞:          10,350,000 ‚ÇΩ
–¢–æ—Ä–≥ (7%):                -724,500 ‚ÇΩ
–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏:            9,625,500 ‚ÇΩ

–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:
  ‚Ä¢ –ù–æ—Ç–∞—Ä–∏—É—Å:               50,000 ‚ÇΩ
  ‚Ä¢ –ì–æ—Å–ø–æ—à–ª–∏–Ω–∞:              4,000 ‚ÇΩ
  ‚Ä¢ –ü–ò–ü (71.7–º¬≤ √ó 1,500):  107,550 ‚ÇΩ
  ‚Ä¢ –ê–≥–µ–Ω—Ç—Å–∫–∏–µ:             200,000 ‚ÇΩ
  ‚Ä¢ –ñ–ö–£ (4 –º–µ—Å):            46,000 ‚ÇΩ
  -------------------------
  –ò—Ç–æ–≥–æ:                   407,550 ‚ÇΩ

–¶–µ–ª–µ–≤–∞—è –ø—Ä–∏–±—ã–ª—å: 17.3%
–ù–∞–ª–æ–≥ –Ω–∞ –ø—Ä–∏–±—ã–ª—å: 13%

–¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞:          7,823,000 ‚ÇΩ  (24.4% –Ω–∏–∂–µ —Ä—ã–Ω–∫–∞)
```

---

## üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ú–æ–¥—É–ª—å: `api/v1/investment_calculator.py`

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```python
def calculate_interest_price(
    market_price: float,
    area_total: float,
    params: Optional[InvestmentParams] = None
) -> InterestPriceResult
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `interest_price` ‚Äî —Ü–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ (‚ÇΩ)
- `interest_price_per_sqm` ‚Äî —Ü–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∑–∞ –º¬≤
- `expected_profit` ‚Äî –æ–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–∏–±—ã–ª—å
- `profit_rate` ‚Äî % –ø—Ä–∏–±—ã–ª–∏ –∫ –≤–ª–æ–∂–µ–Ω–∏—è–º
- `cost_breakdown` ‚Äî –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤

#### –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:

```python
def calculate_interest_price_simple(
    market_price_per_sqm: float,
    area_total: float,
    bargain_discount: float = 0.07,
    target_profit_rate: float = 0.173
) -> float
```

---

## üåê API Integration

### Endpoint: `/estimate`

**–û—Ç–≤–µ—Ç —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:**

```json
{
  "estimated_price": 10350000,
  "estimated_price_per_sqm": 144352,
  "interest_price": 7823000,
  "interest_price_per_sqm": 109100,
  "expected_profit": 1652000,
  "profit_rate": 0.173,
  "investment_breakdown": {
    "–ù–æ—Ç–∞—Ä–∏—É—Å": 50000,
    "–ì–æ—Å–ø–æ—à–ª–∏–Ω–∞": 4000,
    "–ü–ò–ü": 107550,
    "–ê–≥–µ–Ω—Ç—Å–∫–∏–µ": 200000,
    "–ñ–ö–£": 46000,
    "–ù–∞–ª–æ–≥ –Ω–∞ –ø—Ä–∏–±—ã–ª—å": 214760
  }
}
```

---

## üíª UI Display

### 1. –ö–∞—Ä—Ç–æ—á–∫–∞ –≤ Summary:
```
üí∞ –†—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞         üíé –¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞
   10.35 –º–ª–Ω ‚ÇΩ              7.82 –º–ª–Ω ‚ÇΩ
   10,350,000 ‚ÇΩ             ‚Üì 24.4% –æ—Ç —Ä—ã–Ω–∫–∞
```

### 2. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–∫–Ω–æ–ø–∫–∞):
- –†—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞, –¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞, –°–∫–∏–¥–∫–∞, –ü—Ä–∏–±—ã–ª—å
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ (breakdown)
- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏

### 3. –ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫:
- –ì—Ä–∞—Ñ–∏–∫: –†—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞ vs –¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ (–ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è)
- –°–ø–∏—Å–æ–∫: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–µ —Ü–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π –æ—Ü–µ–Ω–∫–∏

---

## üóÑÔ∏è Database

### –¢–∞–±–ª–∏—Ü–∞: `valuation_history`

–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è:
```sql
interest_price BIGINT
interest_price_per_sqm NUMERIC(10, 2)
expected_profit BIGINT
profit_rate NUMERIC(5, 4)
investment_breakdown JSONB
```

### View: `valuation_history_summary`

–í–∫–ª—é—á–∞–µ—Ç:
```sql
market_discount_percent = (estimated_price - interest_price) / estimated_price * 100
```

---

## üé® Customization

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```python
custom_params = InvestmentParams(
    bargain_discount=0.10,        # 10% —Ç–æ—Ä–≥
    target_profit_rate=0.20,      # 20% –ø—Ä–∏–±—ã–ª—å
    notary_fee=60000,
    renovation_per_sqm=15000,     # –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–º–æ–Ω—Ç
    financing_rate=0.15           # 15% –∫—Ä–µ–¥–∏—Ç
)

result = calculate_interest_price(
    market_price=10000000,
    area_total=70,
    params=custom_params
)
```

---

## üìà Use Cases

### 1. **–ò–Ω–≤–µ—Å—Ç–æ—Ä-—Ñ–ª–∏–ø–ø–µ—Ä**
–•–æ—á–µ—Ç –∫—É–ø–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É, —Å–¥–µ–ª–∞—Ç—å –∫–æ—Å–º–µ—Ç–∏–∫—É –∏ –ø—Ä–æ–¥–∞—Ç—å –∑–∞ 4 –º–µ—Å—è—Ü–∞ —Å –ø—Ä–∏–±—ã–ª—å—é 17%.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—É –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫–∞–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –ø–æ–∫—É–ø–∫–∏.

### 2. **–ê–≥–µ–Ω—Ç –ø–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏**
–•–æ—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É, —á—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ –≤—ã–≥–æ–¥–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:** –°—Ä–∞–≤–Ω–∏—Ç—å —Ä—ã–Ω–æ—á–Ω—É—é —Ü–µ–Ω—É —Å —Ü–µ–Ω–æ–π –∏–Ω—Ç–µ—Ä–µ—Å–∞ (—Å–∫–∏–¥–∫–∞).

### 3. **–ê–Ω–∞–ª–∏—Ç–∏–∫ —Ä—ã–Ω–∫–∞**
–•–æ—á–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É "—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π" —Ü–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ—Ü–µ–Ω–æ–∫ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º —Ü–µ–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å–∞.

---

## üîó Links

- **Web UI:** https://rating.ourdocs.org
- **API Docs:** https://rating.ourdocs.org/docs
- **Google Sheets Template:** https://docs.google.com/spreadsheets/d/1G0Wbpy6htjInQ7IunQ_y2CMNijF88qdMby5GSOy5mmU

---

## üõ†Ô∏è Testing

### API Test:
```bash
curl -X POST https://rating.ourdocs.org/estimate \
  -H "Content-Type: application/json" \
  -d '{
    "lat": 55.7558,
    "lon": 37.6173,
    "area_total": 71.7,
    "rooms": 2
  }'
```

### Expected Output:
```json
{
  "estimated_price": 10350000,
  "interest_price": 7823000,
  "profit_rate": 0.173
}
```

---

## üìä Statistics

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:
- ‚úÖ –¶–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è 100% –æ—Ü–µ–Ω–æ–∫
- ‚úÖ –°—Ä–µ–¥–Ω—è—è —Å–∫–∏–¥–∫–∞ –æ—Ç —Ä—ã–Ω–∫–∞: ~20-25%
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## üöÄ Future Enhancements

1. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ UI**
   - –ü–æ–ª–∑—É–Ω–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–∞, –ø—Ä–∏–±—ã–ª–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–∞, –≤—ã—Å–µ–ª–µ–Ω–∏—è

2. **–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —Ç–æ—Ä–≥–∞ –ø–æ —Ä–∞–π–æ–Ω—É
   - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã –ø—Ä–æ–¥–∞–∂–∏

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ï–ì–†–ù**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–µ–º–µ–Ω–µ–Ω–∏–π
   - –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ —Å–¥–µ–ª–∫–∏

4. **Multi-scenario analysis**
   - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π/–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–∏
   - Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 16.12.2025*
