# üöÄ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è Production Deployment

**–î–∞—Ç–∞:** 2025-11-19  
**–ü—Ä–æ–µ–∫—Ç:** Real Estate Data Platform  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Å–∏—Å—Ç–µ–º–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
3. [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏](#–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
5. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
6. [–í–µ–±-—Å–µ—Ä–≤–∏—Å—ã](#–≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã)
7. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
8. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
9. [–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](#–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

---

## üñ•Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ú–∏–Ω–∏–º—É–º | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
|-----------|---------|---------------|
| **CPU** | 2 —è–¥—Ä–∞ | 4+ —è–¥—Ä–∞ |
| **RAM** | 4 GB | 8+ GB |
| **–î–∏—Å–∫** | 50 GB SSD | 100+ GB SSD |
| **–û–°** | Ubuntu 22.04+ | Ubuntu 22.04 LTS |
| **Python** | 3.11+ | 3.12+ |
| **Docker** | 20.10+ | Latest |
| **Docker Compose** | 2.0+ | Latest |

### –°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

- **–í—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:** –ü–æ—Ä—Ç—ã 80, 443, 5432 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î)
- **–ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:** –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π (–¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö)
- **DNS:** –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è A-–∑–∞–ø–∏—Å—å –¥–ª—è –¥–æ–º–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **PostgreSQL 14+** (—Å PostGIS —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º)
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: `postgis/postgis:16-3.4`
   - –ü–æ—Ä—Ç: `5432`
   - –î–∞–Ω–Ω—ã–µ: Volume mount –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

2. **Docker & Docker Compose**
   - –î–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

3. **Python 3.11+**
   - –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (`venv`)
   - –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

4. **Metabase** (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: `metabase/metabase:latest`
   - –ü–æ—Ä—Ç: `3000`
   - –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL

5. **Prefect** (–¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á)
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: `prefecthq/prefect:3-latest`
   - –ü–æ—Ä—Ç: `4200`
   - –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ ETL –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

6. **Nginx** (reverse proxy)
   - –î–ª—è HTTPS –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
   - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)

7. **Cloudflare Tunnel** (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Nginx)
   - –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π HTTPS

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# PostgreSQL
POSTGRES_DB=realdb
POSTGRES_USER=realuser
POSTGRES_PASSWORD=<strong_password>  # ‚ö†Ô∏è –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å!
PG_DSN=postgresql://realuser:<password>@localhost:5432/realdb
PG_DSN_INTERNAL=postgresql://realuser:<password>@postgres:5432/realdb

# –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã PostgreSQL (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
PG_HOST=localhost
PG_PORT=5432
PG_USER=realuser
PG_PASS=<password>
PG_DB=realdb
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

```bash
# Anti-Captcha (–¥–ª—è –æ–±—Ö–æ–¥–∞ –∫–∞–ø—á–∏)
ANTICAPTCHA_KEY=<your_anticaptcha_key>

# –ü—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–∏—Å—ã (–¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
NODEMAVEN_PROXY_URL=http://username:password@gate.nodemaven.com:8080
BRIGHTDATA_PROXY_URL=http://username:password@brd.superproxy.io:33335
SMARTPROXY_URL=http://username:password@gate.smartproxy.com:10000

# DaData API (–¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–æ–≤)
DADATA_API_KEY=<your_dadata_key>
DADATA_SECRET_KEY=<your_dadata_secret>

# Prefect (–¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏)
PREFECT_SERVER_HOST=0.0.0.0

# Cloudflare (–¥–ª—è —Ç—É–Ω–Ω–µ–ª—è)
CLOUDFLARE_API_TOKEN=<your_token>

# Flask (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
SECRET_KEY=<random_secret_key>
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è –¥–ª—è PostgreSQL
openssl rand -base64 32

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SECRET_KEY –¥–ª—è Flask
python3 -c "import secrets; print(secrets.token_hex(32))"
```

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd /home/ubuntu/realestate
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

# Playwright –±—Ä–∞—É–∑–µ—Ä—ã (–¥–ª—è ETL)
playwright install chromium
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `httpx` - HTTP –∫–ª–∏–µ–Ω—Ç
- `tenacity` - Retry –ª–æ–≥–∏–∫–∞
- `pydantic` - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `psycopg2-binary` - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
- `prefect` - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á
- `orjson` - –ë—ã—Å—Ç—Ä—ã–π JSON
- `PyYAML` - YAML –ø–∞—Ä—Å–∏–Ω–≥
- `python-dotenv` - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `playwright` - –ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- `anticaptchaofficial` - –†–µ—à–µ–Ω–∏–µ –∫–∞–ø—á–∏
- `fastapi` - API —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ (–¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- `uvicorn` - ASGI —Å–µ—Ä–≤–µ—Ä

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y \
    python3-pip \
    python3-venv \
    docker.io \
    docker-compose \
    nginx \
    certbot \
    python3-certbot-nginx \
    postgresql-client

# –ó–∞–ø—É—Å–∫ Docker
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker $USER  # –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL

```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
cd /home/ubuntu/realestate
docker compose up -d postgres

# –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
sleep 10

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã
PGPASSWORD=<password> psql -h localhost -U realuser -d realdb -f db/schema.sql

# –ü—Ä–æ–≤–µ—Ä–∫–∞
PGPASSWORD=<password> psql -h localhost -U realuser -d realdb -c "\dt"
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
docker exec realestate-postgres-1 pg_dump -U realuser realdb > backup_$(date +%Y%m%d).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
cat backup_20251119.sql | docker exec -i realestate-postgres-1 psql -U realuser realdb
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ë–î

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker exec -it realestate-postgres-1 psql -U realuser realdb

# –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
SELECT COUNT(*) FROM listings;
SELECT COUNT(*) FROM listing_prices;
SELECT AVG(price)::bigint FROM listing_prices;
```

---

## üåê –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: FastAPI –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /home/ubuntu/realestate
source venv/bin/activate

# –ó–∞–ø—É—Å–∫ web_viewer.py
python web_viewer.py
# –î–æ—Å—Ç—É–ø: http://localhost:8000

# –ò–ª–∏ web_simple.py
python web_simple.py
# –î–æ—Å—Ç—É–ø: http://localhost:8000
```

**–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ systemd:**

–°–æ–∑–¥–∞–π—Ç–µ `/etc/systemd/system/realestate-web.service`:

```ini
[Unit]
Description=Real Estate Web Viewer
After=network.target postgresql.service

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/realestate
Environment="PATH=/home/ubuntu/realestate/venv/bin"
ExecStart=/home/ubuntu/realestate/venv/bin/python /home/ubuntu/realestate/web_viewer.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable realestate-web
sudo systemctl start realestate-web
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: API —Å–µ—Ä–≤–∏—Å

```bash
cd /home/ubuntu/realestate/api
docker build -t realestate-api .
docker run -d \
    --name realestate-api \
    --env-file ../.env \
    -p 8080:8080 \
    realestate-api
```

**Endpoints:**
- `GET /health` - Health check
- `GET /metrics/median-price` - –ú–µ–¥–∏–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã
- `GET /metrics/dom` - Days on Market
- `GET /metrics/price-drops` - –ü–∞–¥–µ–Ω–∏—è —Ü–µ–Ω

### –í–∞—Ä–∏–∞–Ω—Ç 3: Metabase (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)

```bash
# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose
cd /home/ubuntu/realestate
docker compose up -d metabase

# –î–æ—Å—Ç—É–ø: http://localhost:3000
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: Nginx + HTTPS

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
sudo apt install -y nginx certbot python3-certbot-nginx

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo cp infra/nginx/conf.d/realestate.conf /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/realestate.conf /etc/nginx/sites-enabled/

# –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot --nginx -d your-domain.com

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl reload nginx
```

### –í–∞—Ä–∏–∞–Ω—Ç 5: Cloudflare Tunnel (–±–µ–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cloudflared
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
sudo dpkg -i cloudflared-linux-amd64.deb

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—É–Ω–Ω–µ–ª—è
cd infra/cloudflare
./setup-tunnel.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
cloudflared tunnel login
cloudflared tunnel create realestate
cloudflared tunnel route dns realestate your-domain.com
sudo cloudflared service install
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–°–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏**
   ```bash
   # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   openssl rand -base64 32
   ```

2. **Firewall (UFW)**
   ```bash
   sudo ufw default deny incoming
   sudo ufw default allow outgoing
   sudo ufw allow 22/tcp    # SSH
   sudo ufw allow 80/tcp    # HTTP
   sudo ufw allow 443/tcp   # HTTPS
   sudo ufw enable
   ```

3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ PostgreSQL**
   ```bash
   # –í docker-compose.yml —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç 5432 –Ω–µ –æ—Ç–∫—Ä—ã—Ç –Ω–∞—Ä—É–∂—É
   # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å Docker
   ```

4. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   ```bash
   sudo apt update && sudo apt upgrade -y
   docker compose pull
   docker compose up -d
   ```

5. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**
   ```bash
   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø –ë–î (cron)
   0 2 * * * docker exec realestate-postgres-1 pg_dump -U realuser realdb > /backups/db_$(date +\%Y\%m\%d).sql
   ```

6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   sudo tail -f /var/log/auth.log
   docker compose logs -f
   ```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health checks

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
cd /home/ubuntu/realestate
docker compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
curl http://localhost:8000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:8080/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
docker exec realestate-postgres-1 pg_isready -U realuser
```

### –õ–æ–≥–∏

```bash
# Docker –ª–æ–≥–∏
docker compose logs -f

# Systemd –ª–æ–≥–∏
sudo journalctl -u realestate-web -f

# Nginx –ª–æ–≥–∏
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h
du -sh db/data/

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h
```

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
sudo apt install -y \
    python3-pip \
    python3-venv \
    docker.io \
    docker-compose \
    git \
    curl \
    wget

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker $USER
# ‚ö†Ô∏è –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ!
```

### –®–∞–≥ 2: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd /home/ubuntu
git clone <repository_url> realestate
cd realestate
git checkout <branch>  # –Ω–∞–ø—Ä–∏–º–µ—Ä, fix1 –∏–ª–∏ main
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞
cp .env.example .env  # –µ—Å–ª–∏ –µ—Å—Ç—å
# –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ
nano .env

# ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏!
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /home/ubuntu/realestate
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
playwright install chromium
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd /home/ubuntu/realestate
docker compose up -d postgres

# –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (10-30 —Å–µ–∫—É–Ω–¥)
sleep 15

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã
PGPASSWORD=$(grep POSTGRES_PASSWORD .env | cut -d '=' -f2) \
psql -h localhost -U $(grep POSTGRES_USER .env | cut -d '=' -f2) \
     -d $(grep POSTGRES_DB .env | cut -d '=' -f2) \
     -f db/schema.sql
```

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
cd /home/ubuntu/realestate
source venv/bin/activate
python test_system.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ ‚úÖ

### –®–∞–≥ 7: –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç A: FastAPI –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

```bash
cd /home/ubuntu/realestate
source venv/bin/activate

# –°–æ–∑–¥–∞–Ω–∏–µ systemd service
sudo tee /etc/systemd/system/realestate-web.service > /dev/null <<EOF
[Unit]
Description=Real Estate Web Viewer
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/realestate
Environment="PATH=/home/ubuntu/realestate/venv/bin"
EnvironmentFile=/home/ubuntu/realestate/.env
ExecStart=/home/ubuntu/realestate/venv/bin/python /home/ubuntu/realestate/web_viewer.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable realestate-web
sudo systemctl start realestate-web
sudo systemctl status realestate-web
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Docker Compose (–≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã)**

```bash
cd /home/ubuntu/realestate
docker compose up -d
```

### –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Nginx + HTTPS:**

```bash
sudo apt install -y nginx certbot python3-certbot-nginx
sudo cp infra/nginx/conf.d/realestate.conf /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/realestate.conf /etc/nginx/sites-enabled/
sudo nginx -t
sudo certbot --nginx -d your-domain.com
```

**Cloudflare Tunnel:**

```bash
cd /home/ubuntu/realestate/infra/cloudflare
./setup-tunnel.sh
```

### –®–∞–≥ 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ß–µ—Ä–µ–∑ cron:**

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
0 3 * * * cd /home/ubuntu/realestate && source venv/bin/activate && python -m etl.collector_cian.cli to-db --pages 10
```

**–ß–µ—Ä–µ–∑ Prefect:**

```bash
# –ó–∞–ø—É—Å–∫ Prefect —Å–µ—Ä–≤–µ—Ä–∞
docker compose up -d prefect

# –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ flow
cd /home/ubuntu/realestate
source venv/bin/activate
python -c "from etl.flows import daily_flow; daily_flow(pages=10)"
```

### –®–∞–≥ 10: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps
sudo systemctl status realestate-web

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
curl http://localhost:8000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:8080/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
PGPASSWORD=$(grep POSTGRES_PASSWORD .env | cut -d '=' -f2) \
psql -h localhost -U $(grep POSTGRES_USER .env | cut -d '=' -f2) \
     -d $(grep POSTGRES_DB .env | cut -d '=' -f2) \
     -c "SELECT COUNT(*) FROM listings;"
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

- [ ] –°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Ubuntu 22.04+, 4+ GB RAM)
- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Python 3.11+ –∏ venv –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`requirements.txt`)
- [ ] –§–∞–π–ª `.env` —Å–æ–∑–¥–∞–Ω —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏
- [ ] PostgreSQL –∑–∞–ø—É—â–µ–Ω –∏ —Å—Ö–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (`test_system.py`)
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (UFW)
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Nginx –∏–ª–∏ Cloudflare)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (systemd)

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: PostgreSQL –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs postgres

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
sudo lsof -i :5432

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose down postgres
docker volume rm realestate_db_data  # ‚ö†Ô∏è –£–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!
docker compose up -d postgres
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep python

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
sudo lsof -i :8000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sudo journalctl -u realestate-web -n 50

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart realestate-web
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cat .env | grep PG_

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
PGPASSWORD=<password> psql -h localhost -U realuser -d realdb -c "SELECT 1;"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker —Å–µ—Ç–∏
docker network inspect realestate_services-net
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **README.md** - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **TEST_REPORT.md** - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **FINAL_DEPLOYMENT_GUIDE.md** - –î–µ—Ç–∞–ª—å–Ω—ã–π –≥–∞–π–¥ –ø–æ –¥–µ–ø–ª–æ—é
- **infra/README.md** - –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **docs/** - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üéØ –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

‚úÖ –†–∞–±–æ—Ç–∞—é—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å –¥–∞–Ω–Ω—ã–º–∏  
‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö  
‚úÖ API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π  
‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (ETL)  
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ HTTPS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤  

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

